(function(){function r(n,i){if(!n||!i){var s="Notification: Invalid parameters (level, message)";throw new r(e.error,s),new Error(s)}this.level=n,this.message=i;var o=8;this.id=(new Date).getTime()+"."+Math.round(Math.random()*1e5);var u="notification-wrapper-";switch(n){case e.debug:u+="debug",o=3;break;case e.info:u+="info",o=4;break;case e.warning:u+="warning",o=4;break;case e.error:u+="error",o=20;break;case e.fatal:u+="fatal",o=20;break;default:u+="default"}t.push(this);var a='<div class="notification-wrapper" id="notification-'+this.id+'">'+'<div class="'+u+'" id="notification-content-'+this.id+'">'+"<p>"+i+" </p>"+"</div>"+"</div>";$("notifications").insert(a),this.startTime=new Date,this.endTime=null,$("notification-"+this.id).hide();var f=this;Effect.SlideDown("notification-"+this.id,{duration:.6,restoreAfterFinish:!1,afterFinish:function(e){Event.observe(e.element,"click",function(){f.remove()})}}),this._timer=setTimeout(function(){f.remove()},o*1e3),Object.seal(this)}var e={debug:1,info:2,warning:3,error:4,fatal:5};Object.freeze(e);var t=[],n=[];r.prototype.remove=function(){if(!this._timer)return;var e=this;Effect.SlideUp("notification-"+this.id,{duration:.4,afterFinish:function(r){r.element.remove(),e.endTime=new Date;for(var i=0;i<t.length;i++)if(t[i]==e){t.splice(i,1),Object.freeze(e),n.push(e);break}}}),clearTimeout(this._timer),this._timer=null},this.Notifications={LEVELS:e,history:n,Display:function(e,t){new r(e,t)}},Object.freeze(this.Notifications)})(),function(){function r(e){var t=!1,n=1;typeof e=="boolean"&&(t=e,e=arguments[1]||{},n=2),typeof e!="object"&&typeof e!="function"&&(e={});for(var i=arguments.length;n<i;++n){var s=arguments[n];if(s!=null)for(var o in s){var u=e[o],a=s[o];if(e===a)continue;if(t&&a&&(Object.isArray(a)||typeof a=="object")){var f=u&&(Object.isArray(u)||typeof u=="object")?u:Object.isArray(a)?[]:{};e[o]=r(t,f,a)}else a!==undefined&&s.hasOwnProperty(o)&&(e[o]=a)}}return e}function i(e){var t=null;e=Number(e);if(!isNaN(e)){var n=Math.floor(e/3600),r=Math.floor(e%3600/60),i=Math.floor(e%3600%60);t=(n>0?n+":":"")+(r>0?(n>0&&r<10?"0":"")+r+":":"0:")+(i<10?"0":"")+i}return t}function s(e){e=e.sort(function(e,t){return e*1-t*1});var t=[e[0]];for(var n=1;n<e.length;n++)e[n-1]!==e[n]&&t.push(e[n]);return t}function o(e){var t=JSON.stringify(e,null,"	");return t=t.replace(/\n/g,"<br />"),t=t.replace(/\t/g,"&nbsp;&nbsp;&nbsp;"),t}function f(e,t){if(!(this instanceof arguments.callee))return new f(e,t);this.name=e;switch(e){case"join_channel":this.channel=t.channel;break;case"next":case"previous":case"shuffle_play_queue":case"get_uploaded_files":break;case"add_to_play_queue":case"remove_from_play_queue":this.mid=t.mid,this.play_queue_index=t.play_queue_index;break;case"move_in_play_queue":this.mid=t.mid,this.play_queue_index=t.play_queue_index,this.new_play_queue_index=t.new_play_queue_index;break;case"get_news":this.first_result=t.first_result,this.result_count=t.result_count;break;case"select_plugin":this.channel=t.channel,this.plugin_name=t.plugin_name;break;case"search":case"update_uploaded_file":case"add_search_to_play_queue":r(this,t);break;case"delete_uploaded_file":case"validate_uploaded_file":this.file_name=t.file_name;break;default:throw new Error("Invalid action")}Object.seal(this)}function l(e,t){if(!(this instanceof arguments.callee))return new l(e,t);this.lastTimestamp=e,this.actions=[],this.search=null;if(t)for(var n=0;n<t.length;++n)t[n]instanceof f&&this.actions.push(t[n]);Object.seal(this)}function c(e,t,n){this.name=e,this.uploadedFiles=t,this.uploadedFilesEdition=n}function d(e,t){function N(e){y.addAction(e),C()}function C(){T.activity(!0);if(b!==!1){y.actions.length>0&&(E.push(y),y=new l);return}w!=null&&(clearTimeout(w),w=null),b=!0;var e=y;y=new l,k(e)}function k(e){e.setTimestamp(s);try{T.sendingQuery(e.valueOf())}catch(t){}var n=e.toJSON();new Ajax.Request(i.URL,{method:"POST",postBody:n,onSuccess:H.querySuccess,onFailure:H.queryFailure,onComplete:H.queryComplete})}function L(e){e.timestamp&&(s=e.timestamp),e.current_song&&(a=e.current_song,n.song=r(!0,{},a),n.lastServerResponse=new Date,T.updateCurrentSong(a),T.updateSongTime(a,n.lastServerResponse.getTime()/1e3));if(e.channel_infos){o=e.channel_infos,n.channel=o.name;var t="",i;g>e.channel_infos.listener_count?(i=g-e.channel_infos.listener_count,t=i+" user"+(i>1?"s":"")+" left the channel",Notifications.Display(Notifications.LEVELS.debug,t)):g<e.channel_infos.listener_count&&(i=e.channel_infos.listener_count-g,t=i+" user"+(i>1?"s":"")+" join the channel",Notifications.Display(Notifications.LEVELS.debug,t)),n.listenersCount=g=e.channel_infos.listener_count,T.updateNbUsers(g)}if(e.play_queue){u=e.play_queue.songs;var f=r(!0,[],u);T.displayPlayQueue(f,g)}e.search_results&&T.displaySearchResults(e.search_results),e.messages&&e.messages.each(function(e){Notifications.Display(e.level,e.message)}),e.uploaded_files&&(S=e.uploaded_files,T.displayUploadedFiles(S))}function A(e,t){var n;if(Object.isArray(e)&&Object.isArray(t))for(var r=0,i=Math.min(e.length,t.length);r<i;r++)n=new f("add_to_play_queue",{mid:e[r],play_queue_index:t[r]}),y.addAction(n);else n=new f("add_to_play_queue",{mid:e,play_queue_index:t}),y.addAction(n);C()}function O(e,t){var n;if(arguments.length===0)for(var r=u.length-1;r>=0;--r)n=new f("remove_from_play_queue",{mid:r,play_queue_index:r}),y.addAction(n);else if(Object.isArray(e)&&Object.isArray(t))for(var i=0,s=Math.min(e.length,t.length);i<s;++i)n=new f("remove_from_play_queue",{mid:e[i],play_queue_index:t[i]}),y.addAction(n);else n=new f("remove_from_play_queue",{mid:e,play_queue_index:t}),y.addAction(n);C()}function M(e,t,n,r,i,s,o){var u={play_queue_position:e,select_fields:"mid",search_value:t,search_comparison:n,search_field:r,order_by:i,first_result:0,result_count:null};n=="like"&&(u.first_result=s,u.result_count=o),N(new f("add_search_to_play_queue",u))}function _(){typeof x=="function"&&x.call(n)}function D(){try{return"localStorage"in window&&window.localStorage!==null}catch(e){return!1}}function P(e){var t=localStorage[e];if(t)try{t=JSON.parse(t)}catch(n){t=null}else t=null;return t}if(!(this instanceof arguments.callee))return new d(e,t);this.id="Jukebox"+ ++h,this.stream="",this.channel="",this.song=null,this.listenersCount=0,this.streaming=!1,this.playing=!1,this.lastServerResponse=null;var n=this,i=r(!0,{},d.defaults,t),s=0,o=null,u=[],a=null,c=null,v=100,g=0,y=new l(0),b=!1,w=null,E=[],S={},x=null,T=null;this.ready=function(e){if(typeof e!="function"){var t="Invalid parameter: .ready() needs a function";throw Notifications.Display(Notifications.LEVELS.error,t),new Error(t)}return x=e,soundManager.enabled&&_(),this},this.autoRefresh=function(e){return i.autorefresh=!!e,i.autorefresh&&C(),this},this.refresh=function(){return s=0,C(),this},this.joinChannel=function(e){return N(new f("join_channel",{channel:e})),this},this.start=function(){return c.play(),this.streaming=!0,T.playing(this.playing=!0),this},this.stop=function(){return c.unload(),this.streaming=!1,T.playing(this.playing=!1),this},this.volume=function(e){if(arguments.length>0){e=Number(e);if(e<0||e>100){var t="Invalid volume level: "+e+" is not in 0-100 range";throw Notifications.Display(Notifications.LEVELS.error,t),new Error(t)}c.setVolume(e),T.volume(e)}return v=c.volume,v},this.search=function(){var e=f.search.apply(0,arguments);return N(e),this},this.addToPlayQueue=function(e,t){return A(e,t),this},this.addToPlayQueueRandom=function(e){return A(e,Math.floor(Math.random()*u.length)),this},this.addToPlayQueueTop=function(e){return A(e,0),this},this.addToPlayQueueBottom=function(e){return A(e,u.length),this},this.playQueueShuffle=function(){return N(new f("shuffle_play_queue")),this},this.playQueueDelete=function(e,t){return arguments.length===0?O():O(e,t),this},this.playQueueMove=function(e,t,n){return N(new f("move_in_play_queue",{mid:e,play_queue_index:t,new_play_queue_index:n})),this},this.playQueueSize=function(){return u.length},this.addSearchToPlayQueueRandom=function(e,t,n,r,i,s){return M("rand",e,t,n,r,i,s),this},this.addSearchToPlayQueueTop=function(e,t,n,r,i,s){return M("head",e,t,n,r,i,s),this},this.addSearchToPlayQueueBottom=function(e,t,n,r,i,s){return M("tail",e,t,n,r,i,s),this},this.savePlayQueue=function(e){if(D()){var t=P("playqueues")||{},n=[];for(var r=0,i=u.length;r<i;++r)n[r]=u[r].mid;t[e]=n,localStorage.playqueues=JSON.stringify(t)}else Notifications.Display(Notifications.LEVELS.warning,"Cannot save playqueue: HTML5 storage not supported!");return this},this.restorePlayQueue=function(e,t){if(D()){var n=P("playqueues"),r=!1;if(n!==null){var i=n[e],s=t=="head"?0:t=="rand"?Math.floor(Math.random()*u.length):u.length;i?A(i,$R(s,s+i.length).toArray()):r=!0}else r=!0;r&&Notifications.Display(Notifications.LEVELS.warning,"Unknown play queue in storage!")}return this},this.deletePlayQueue=function(e){if(D()){var t=P("playqueues");t&&(delete t[e],localStorage.playqueues=JSON.stringify(t))}return this},this.next=function(){return N(new f("next")),this},this.previous=function(){return N(new f("previous")),this},this.plugin=function(e){return N(new f("select_plugin",{channel:o.name,plugin_name:e})),this},this.getUploadedFiles=function(){return N(new f("get_uploaded_files")),this},this.uploadedFiles=function(){return S.files?S.files.slice():[]},this.deleteUploadedFile=function(e){return N(new f("delete_uploaded_file",{file_name:e})),this},this.validateUploadedFile=function(e){return N(new f("validate_uploaded_file",{file_name:e})),this},this.updateUploadedFile=function(e){return N(new f("update_uploaded_file",e)),this},p=function(e){y=e,C()};var H={querySuccess:function(e){i.autorefresh&&(w=setTimeout(function(){C()},i.autorefresh_delay));if(e.readyState==4&&e.status===0){T.gotResponse(null);return}T.gotResponse(e.responseText),L(e.responseJSON)},queryFailure:function(){T.gotResponse(null)},queryComplete:function(){b=!1,T.activity(!1);if(E.length>0){y.actions.length>0&&E.push(y);var e=E.splice(0,1)[0];y=e,C()}}};(function(){Object.seal(n),soundManager.setup({url:i.SM2Folder,flashVersion:9,useFlashBlock:!0,debugMode:!1,useHTML5Audio:!0,preferFlash:!1,onready:function(){var e=0,t=new Date;(function r(s){c=soundManager.createSound({id:n.id,url:i.streamURL+"?t="+(new Date).getTime(),autoPlay:s,onbufferchange:function(){e++,e>2&&setTimeout(function(){e=0;var t=c.volume;c.destruct(),r(!0),c.setVolume(t)},0);var n=new Date;n.getTime()-t.getTime()>2e3&&(e=0,t=n)}})})(!1),Notifications.Display(Notifications.LEVELS.debug,"Using "+(c.isHTML5?"HTML5":"flash")+" audio player"),_()},ontimeout:function(){var e="SM2 could not start";throw Notifications.Display(Notifications.LEVELS.error,e),new Error(e)}}),T=new m(n,e,{replaceTitle:i.replaceTitle,skin:i.skin,theme:i.theme}),i.autorefresh&&C()})()}function m(e,n,s){function g(){p.expand_button.hide(),p.collapse_button.show(),p.jukebox.addClassName(u.rootClass+"-fullplayer")}function y(){p.expand_button.show(),p.collapse_button.hide(),p.jukebox.removeClassName(u.rootClass+"-fullplayer")}function b(e,t,n,r,i,s,o,u,a){s||(s=p.search_field.value),r||(s!="genre"?r=p.search_input.value:r=p.search_genres.value),u||(u=p.results_per_page.value),f.search(e,t,n,r,i,s,o,u,a)}function w(e,t){b(1,null,null,e,"equal",t,"artist,album,track,title",null,!1)}function E(){p.play_queue_content.select("."+u.rootClass+"-playqueue-droppable").each(function(e){Droppables.remove(e)})}function S(e,t){var n=e.className.split(" "),r=t?u.rootClass+"-playqueue-":u.rootClass+"-playqueue-song-",i=null;for(var s=0;s<n.length;++s)if(n[s].indexOf(r)!=-1){i=n[s].substring(r.length);break}return i}function x(e,t){Droppables.add(e,{accept:[u.rootClass+"-playqueue-draggable","library-draggable"],overlap:"vertical",hoverclass:u.rootClass+"-droppable-hover",onDrop:function(e,n){var r,i;if(e.hasClassName(u.rootClass+"-playqueue-draggable")){var s=S(e);r=parseInt(s,10),i=e.up().retrieve("mid");var a=-1;if(!n.hasClassName(u.rootClass+"-playqueue-first")){var c=S(n,!0);a=parseInt(c,10)}a<=r&&a++;if(a!=r){f.playQueueMove(i,r,a),E();var h=t[r];t.splice(r,1),t.splice(a,0,h),o.displayPlayQueue(t)}}else if(e.hasClassName("library-draggable")){var p=new RegExp(".*-([^\\-]*-[^\\-]*)-([0-9]*)"),d=e.id.replace(p,"$1");r=parseInt(e.id.replace(p,"$2"),10);var v=l.getTabFromUniqueId(d).server_results[r];i=v.mid;var m=-1;if(!n.hasClassName(u.rootClass+"-playqueue-first")){var g=S(n,!0);m=parseInt(g,10)}m++,f.addToPlayQueue(i,m),t.splice(m,0,v),o.displayPlayQueue(t)}}})}if(!(this instanceof arguments.callee))return new m(n,s);this.skin=m.defaults.skin,this.theme="";var o=this,u=r(!0,{},m.defaults,s),f=e,l=null,c=m.skins[u.skin],h,p,d=null,v=null;c?this.skin=u.skin:(u.skin=m.defaults.skin,c=m.skins[u.skin]),c.params=r(!0,{},m.defaults.skinParams,c.params),u.theme=(c.themes||[]).indexOf(u.theme)==-1?c.defaultTheme:u.theme,this.theme=u.theme,u.rootClass+=u.skin==m.defaults.skin?"":"-"+u.skin,this.activity=function(e){var t=u.rootClass+"-activity-on",n=u.rootClass+"-activity-off",r=n,i=t;e===!0&&(r=t,i=n),p.activity_monitor.removeClassName(i),p.activity_monitor.addClassName(r)},this.volume=function(e){h.setValue(e)},this.updateSongTime=function(e,t){d&&clearTimeout(d);var n=100;if(e){var r=e.elapsed+(new Date).getTime()/1e3-t;n=(Math.ceil(r)-r)*1e3,r>e.duration&&(r=e.duration);if(v===null||r>v){var s=Math.round(r/e.duration*100);p.progressbar.setStyle({width:s+"%"}),p.player_song_time.update(i(r)+"/"+i(e.duration))}v=r}else v=null,p.progressbar.setStyle({width:0}),p.player_song_time.update("--- / ---");d=setTimeout(function(){o.updateSongTime(e,t)},n+1)},this.updateCurrentSong=function(e){e&&(p.player_song_artist.update(e.artist).stopObserving().on("click",function(){w(e.artist,"artist")}),p.player_song_album.update(e.album).stopObserving().on("click",function(){w(e.album,"album")}),p.player_song_title.update(e.title),u.replaceTitle&&(document.title="Jukebox - "+e.artist+" - "+e.album+" - "+e.title))},this.updateNbUsers=function(e){var t=p.jukebox.select("."+u.rootClass+"-listening-count");t.each(function(t){t.update(e.toString())})},this.playing=function(e){e?(p.play_stream.hide(),p.stop_stream.style.display="inline"):(p.play_stream.show(),p.stop_stream.hide())},this.displayPlayQueue=function(e){function d(e){var t=S(e.element);t!==null&&r.down(s+"playqueue-"+t).addClassName(u.rootClass+"-being-dragged")}function v(e){var t=S(e.element);t!==null&&r.down(s+"playqueue-"+t).removeClassName(u.rootClass+"-being-dragged")}E();var t=new Template(c.templates.playQueue),n={root:u.rootClass,playQueueLabel:"Play queue",listenersCount:f.listenersCount},r=(new Element(c.params.playQueueNode)).insert(t.evaluate(n)),s="."+u.rootClass+"-",o=r.down(s+"playqueue-shuffle"),a=r.down(s+"playqueue-delete");o&&o.on("click",function(){f.playQueueShuffle()}),a&&a.on("click",function(){f.playQueueDelete()});var l=0,h=e.length-1;e.each(function(e){var t=new Template(c.templates.playQueueSong),n={root:u.rootClass,index:l,artist:e.artist,album:e.album,title:e.title,duration:i(e.duration)};r.insert(t.evaluate(n));var o=r.down(c.params.songNode+":last");o.store("mid",e.mid);var p=o.down(s+"playqueue-handle a:first");p&&p.on("click",function(){b(1,null,null,e.artist,"equal","artist","artist,album,track,title",20,!1)});var d=o.down(s+"playqueue-handle a:last");d&&d.on("click",function(){b(1,null,null,e.album,"equal","album","artist,album,track,title",20,!1)});var v=l,m=o.down(s+"playqueue-move-top"),g=o.down(s+"playqueue-move-bottom");m&&m.on("click",function(){f.playQueueMove(1,v,0)}),g&&g.on("click",function(){f.playQueueMove(1,v,h)}),a=o.down(s+"playqueue-delete"),a&&a.on("click",function(){f.playQueueDelete(1,v)}),l++}),r.nodeName=="TBODY"&&(r=r.wrap("table")),p.play_queue_content.update(r);for(var m=0,g=e.length;m<g;m++){var y=r.down(s+"playqueue-"+m),w=y.down(s+"playqueue-song-"+m),T=w.down(s+"playqueue-handle-"+m);new Draggable(w,{scroll:window,constraint:"vertical",revert:!0,handle:T,onStart:d,onEnd:v}),x(y,e)}x(r.down(s+"playqueue-first"),e)},this.displaySearchResults=function(e){g();if(!e.identifier){var t=new SearchTab(f,p.tabs,e,u.rootClass),n=l.addTab(t);e.select!==!1&&l.toggleTab(n)}else l.getTabFromUniqueId(e.identifier).updateNewSearchInformations(e),l.getTabFromUniqueId(e.identifier).updateContent()},this.sendingQuery=function(e){var t=l.getFirstTabByClass(DebugTab);t&&t.updateSendingQuery(e)},this.gotResponse=function(e){var t=l.getFirstTabByClass(DebugTab);t&&t.updateResponse(e)},this.displayUploadedFiles=function(e){var t=l.getFirstTabByClass(a);t&&t.treatResponse(e)},this.theme=function(e){if(arguments.length>0){var t=u.rootClass+"-theme-";p.jukebox.removeClassName(t+u.theme),u.theme=e,p.jukebox.addClassName(t+u.theme),this.theme=u.theme}return u.theme};var T={expand:function(){g()},collapse:function(){y()},joinChannel:function(){f.joinChannel(p.channel.value)},previousSong:function(){f.previous()},nextSong:function(){f.next()},playStream:function(){f.start()},stopStream:function(){f.stop()},volume:function(e){f.volume()!=e&&f.volume(e)},search:function(){b()},searchInputKeyPress:function(e){e.keyCode==Event.KEY_RETURN&&(b(),Event.stop(e))},selectAndFillGenres:function(){if(p.search_field.options[p.search_field.selectedIndex].value=="genre"){if(p.search_genres.options.length===0)for(var e=0,n=t.length;e<n;++e){var r=t[e],i=document.createElement("option");i.value=r.id,i.appendChild(document.createTextNode(r.name)),p.search_genres.appendChild(i)}p.search_input.hide(),p.search_genres.show()}else p.search_input.show(),p.search_genres.hide()},autoRefreshChange:function(){f.autoRefresh(p.cb_autorefresh.getValue())},refresh:function(){f.refresh()},plugin:function(){f.plugin(p.selection_plugin.value)}};(function(){Object.seal(o);var e=$(n);try{var t=new Template(c.templates.song),r={root:u.rootClass},i=new Template(c.templates.player),s={root:u.rootClass,theme:u.theme,currentSong:t.evaluate(r),canalLabel:"Canal :",canalValue:"Rejoindre",searchLabel:"Rechercher :",searchButton:"Rechercher",UploadTabName:"Upload",QueryTabName:"Query",NotificationsTabName:"Notifications",DebugTabName:"Debug",artist:"artiste",title:"title",album:"album",genre:"genre",refreshButton:"Refresh",refreshLabel:"Autorefresh",pluginLabel:"Plugin :",pluginDefault:"default",pluginButton:"Appliquer",play:"Play stream",stop:"Stop stream",volume:"Volume :",listenersCount:f.listenersCount};e.insert(i.evaluate(s))}catch(d){var v="Invalid skin: "+d.message;throw Notifications.Display(Notifications.LEVELS.error,v),new Error(v)}var m="."+u.rootClass+"-",g=e.down("."+u.rootClass);p={jukebox:g,tabs:g.down(m+"tabs"),expand_button:g.down(m+"expand-button"),collapse_button:g.down(m+"collapse-button"),search_input:g.down(m+"search-input"),search_field:g.down(m+"search-field"),search_genres:g.down(m+"search-genres"),results_per_page:g.down(m+"results-per-page"),btn_search:g.down(m+"search-button"),progressbar:g.down(m+"progressbar"),player_song_time:g.down(m+"song-time"),activity_monitor:g.down(m+"activity"),play_stream:g.down(m+"stream-play"),stop_stream:g.down(m+"stream-stop"),channel:g.down(m+"channel"),btn_join_channel:g.down(m+"channel-button"),previous_button:g.down(m+"previous-button"),next_button:g.down(m+"next-button"),cb_autorefresh:g.down(m+"autorefresh"),btn_refresh:g.down(m+"refresh-button"),player_song_artist:g.down(m+"song-artist"),player_song_album:g.down(m+"song-album"),player_song_title:g.down(m+"song-title"),play_queue_content:g.down(m+"playqueue-content"),selection_plugin:g.down(m+"plugin"),btn_apply_plugin:g.down(m+"plugin-button"),volume_box_slider:g.down(m+"volume-slider"),tabs_links:g.down(m+"tabs-links")},p.collapse_button.hide(),p.stop_stream.hide();var y=new Element("p");for(var b in p)p[b]||(p[b]=y);l=new Tabs(u.rootClass),l.setRootNode(p.tabs),p.expand_button.on("click",T.expand),p.collapse_button.on("click",T.collapse),p.play_stream.on("click",T.playStream),p.stop_stream.on("click",T.stopStream),p.btn_join_channel.on("click",T.joinChannel),p.btn_search.on("click",T.search),p.search_field.on("change",T.selectAndFillGenres),p.search_input.observe("keypress",T.searchInputKeyPress),p.previous_button.on("click",T.previousSong),p.next_button.on("click",T.nextSong),p.cb_autorefresh.on("change",T.autoRefreshChange),p.btn_refresh.on("click",T.refresh),p.btn_apply_plugin.on("click",T.plugin);var w=$R(0,100);h=new Control.Slider(p.volume_box_slider.down(m+"volume-handle"),p.volume_box_slider,{range:w,values:w,sliderValue:100,onSlide:T.volume,onChange:T.volume}),function(){function t(t){e["Show"+t.classN]=function(){var e=l.getFirstTabByClass(t.classC);if(e===null){var n=new t.classC(t.name,p.tabs,u.rootClass,f);e=l.addTab(n)}l.toggleTab(e)}}var e={},n=[{classN:"UploadTab",classC:a,name:"Uploader"},{classN:"DebugTab",classC:DebugTab,name:"Debug"},{classN:"NotificationTab",classC:NotificationTab,name:"Notifications"},{classN:"CustomQueriesTab",classC:CustomQueriesTab,name:"Custom queries"}];for(var r=0;r<n.length;++r)t(n[r]);var i=p.tabs_links;i.empty()||(i.down(m+"tab-upload").on("click",e.ShowUploadTab),i.down(m+"tab-query").on("click",e.ShowCustomQueriesTab),i.down(m+"tab-notifs").on("click",e.ShowNotificationTab),i.down(m+"tab-debug").on("click",e.ShowDebugTab))}()})()}var e={0:"Blues",1:"Classic Rock",2:"Country",3:"Dance",4:"Disco",5:"Funk",6:"Grunge",7:"Hip-Hop",8:"Jazz",9:"Metal",10:"New Age",11:"Oldies",12:"Other",13:"Pop",14:"R&B",15:"Rap",16:"Reggae",17:"Rock",18:"Techno",19:"Industrial",20:"Alternative",21:"Ska",22:"Death Metal",23:"Pranks",24:"Soundtrack",25:"Euro-Techno",26:"Ambient",27:"Trip-Hop",28:"Vocal",29:"Jazz+Funk",30:"Fusion",31:"Trance",32:"Classical",33:"Instrumental",34:"Acid",35:"House",36:"Game",37:"Sound Clip",38:"Gospel",39:"Noise",40:"Alternative Rock",41:"Bass",43:"Punk",44:"Space",45:"Meditative",46:"Instrumental Pop",47:"Instrumental Rock",48:"Ethnic",49:"Gothic",50:"Darkwave",51:"Techno-Industrial",52:"Electronic",53:"Pop-Folk",54:"Eurodance",55:"Dream",56:"Southern Rock",57:"Comedy",58:"Cult",59:"Gangsta",60:"Top 40",61:"Christian Rap",62:"Pop/Funk",63:"Jungle",64:"Native US",65:"Cabaret",66:"New Wave",67:"Psychadelic",68:"Rave",69:"Showtunes",70:"Trailer",71:"Lo-Fi",72:"Tribal",73:"Acid Punk",74:"Acid Jazz",75:"Polka",76:"Retro",77:"Musical",78:"Rock & Roll",79:"Hard Rock",80:"Folk",81:"Folk-Rock",82:"National Folk",83:"Swing",84:"Fast Fusion",85:"Bebob",86:"Latin",87:"Revival",88:"Celtic",89:"Bluegrass",90:"Avantgarde",91:"Gothic Rock",92:"Progressive Rock",93:"Psychedelic Rock",94:"Symphonic Rock",95:"Slow Rock",96:"Big Band",97:"Chorus",98:"Easy Listening",99:"Humour",100:"Acoustic",101:"Speech",102:"Chanson",103:"Opera",104:"Chamber Music",105:"Sonata",106:"Symphony",107:"Booty Bass",108:"Primus",109:"Porn Groove",110:"Satire",111:"Slow Jam",112:"Club",113:"Tango",114:"Samba",115:"Folklore",116:"Ballad",117:"Power Ballad",118:"Rhytmic Soul",119:"Freestyle",120:"Duet",121:"Punk Rock",122:"Drum Solo",123:"Acapella",124:"Euro-House",125:"Dance Hall",126:"Goa",127:"Drum & Bass",128:"Club-House",129:"Hardcore",130:"Terror",131:"Indie",132:"BritPop",133:"Negerpunk",134:"Polsk Punk",135:"Beat",136:"Christian Gangsta",137:"Heavy Metal",138:"Black Metal",139:"Crossover",140:"Contemporary C",141:"Christian Rock",142:"Merengue",143:"Salsa",144:"Thrash Metal",145:"Anime",146:"JPop",147:"SynthPop"},t=[];for(var n in e)t.push({id:n,name:e[n]});t.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0});var u=this.Tab=Class.create({initialize:function(e,t,n,r){this.name=e,this.jukebox=t,this.DOM=n,this.rootCSS=r}});this.Tabs=Class.create({initialize:function(e){this.rootCSS=e,this.tabs=[],this.currentTabUniqueId=-1,this.lastUniqueId=null},getTabFromUniqueId:function(e){for(var t=0,n=this.tabs.length;t<n;++t)if(this.tabs[t].identifier==e)return this.tabs[t];return null},getTabIndexFromUniqueId:function(e){for(var t=0,n=this.tabs.length;t<n;++t)if(this.tabs[t].identifier==e)return t;return-1},getFirstTabByClass:function(e){for(var t=0;t<this.tabs.length;++t)if(this.tabs[t]instanceof e)return this.tabs[t];return null},setRootNode:function(e){this.DOM=e},addTab:function(e){var t=e.constructor;while(t.superclass!=null)t=t.superclass;if(t!=u)throw new Error("Invalid tab instance");this.lastUniqueId==null?this.lastUniqueId=0:this.lastUniqueId++;var n=e.identifier=this.lastUniqueId;this.tabs.push(e),this.tabs.length==1&&this.DOM.down("."+this.rootCSS+"-tabs-header").update('<ul class="'+this.rootCSS+'-tabs-list"></ul>');var r="javascript:;",i=(new Element("a",{href:r})).update("<span>"+e.name+"</span>"),s=(new Element("a",{href:r})).update("<span> X </span>"),o=this;i.on("click",function(){o.toggleTab(n)}),s.on("click",function(){o.removeTab(n)});var a=(new Element("li",{"class":this.rootCSS+"-tabHeader-"+n})).insert({top:i,bottom:s});this.tabs.length==1&&a.addClassName(this.rootCSS+"-tabs-active");var f=new Element("div",{"class":this.rootCSS+"-tabContent-"+n});return this.tabs.length>1&&f.hide(),this.DOM.down("."+this.rootCSS+"-tabs-list").insert(a),this.DOM.down("."+this.rootCSS+"-tabs-content").insert(f),typeof e.updateContent=="function"&&e.updateContent(),n},removeTab:function(e){var t=this.getTabIndexFromUniqueId(e);if(t!=-1){var n=this.DOM.down("."+this.rootCSS+"-tabs-list").down("."+this.rootCSS+"-tabHeader-"+e),r=this.DOM.down("."+this.rootCSS+"-tabs-content").down("."+this.rootCSS+"-tabContent-"+e);n&&n.hasClassName(this.rootCSS+"-tabs-active")&&(t!==0?this.toggleTab(this.tabs[t-1].identifier):this.tabs.length>1&&this.toggleTab(this.tabs[t+1].identifier)),this.tabs.splice(t,1),n&&n.remove(),r&&r.remove()}},toggleTab:function(e){for(var t=0,n=this.tabs.length;t<n;++t){var r=this.tabs[t],i=r.identifier,s=this.DOM.down("."+this.rootCSS+"-tabs-list").down("."+this.rootCSS+"-tabHeader-"+i),o=this.DOM.down("."+this.rootCSS+"-tabs-content").down("."+this.rootCSS+"-tabContent-"+i);r.identifier==e?(o.show(),s.addClassName(this.rootCSS+"-tabs-active")):(o.hide(),s.removeClassName(this.rootCSS+"-tabs-active"))}}}),this.SearchTab=Class.create(u,{initialize:function($super,e,t,n,r){this.reloadControllers=!0,this.pages=[],this.sliders=[],this.tableKit=null;var i=n.identifier;$super(i,e,t,r),this.updateNewSearchInformations(n)},updateNewSearchInformations:function(t){var n=t.search_value,r=t.search_field;n===""?this.name="Library":t.search_comparison=="equal"?r=="artist"?this.name="Artist: "+n:r=="album"?this.name="Album: "+n:r=="genre"&&(this.name="Genre: "+e[n]):this.name=n,this.select_fields=t.select_fields,this.search_value=t.search_value,this.search_comparison=t.search_comparison,this.search_field=t.search_field,this.first_result=t.first_result,this.result_count=t.result_count,this.order_by=t.order_by,this.total_results=t.total_results,this.server_results=t.results,this.page_count=Math.floor(this.total_results/this.result_count),this.total_results%this.result_count>0&&(this.page_count=this.page_count+1),this.current_page=Math.floor(this.first_result/this.result_count)+1,this.current_page>this.page_count&&(this.current_page=1),this.locked=[]},goToPage:function(e){this.jukebox.search((e-1)*this.result_count,this.identifier,this.select_fields,this.search_value,this.search_comparison,this.search_field,this.order_by,this.result_count)},sort:function(e){this.jukebox.search(this.page,this.identifier,this.select_fields,this.search_value,this.search_comparison,this.search_field,e,this.result_count)},updateContent:function(){if(this.reloadControllers){this.DOM.select("collection-pagelist-"+this.identifier).each(function(e){e.remove()});var e=$("collection-content-"+this.identifier);e&&e.remove();var t='<div class="collection-pagelist" name="collection-pagelist-'+this.identifier+'"></div>'+'<div id="collection-content-'+this.identifier+'"></div>'+'<div class="collection-pagelist" name="collection-pagelist-'+this.identifier+'"></div>';this.DOM.down("."+this.rootCSS+"-tabContent-"+this.identifier).update(t),this.initAndDisplaySearchControllers(),this.reloadControllers=!1}else{this.generatePagesLinks();for(var n in this.sliders)typeof this.sliders[n].setValue=="function"&&(this.locked[n]=!0,this.sliders[n].setValue(this.current_page),this.locked[n]=!1)}this.initAndDisplaySearchResults()},initAndDisplaySearchControllers:function(){var e=this.identifier,t=$$("[name=collection-pagelist-"+e+"]");t.each(function(e){e.update()});if(this.total_results>0&&this.page_count>1){var n=this.dom.getWidth(),r='<div name="results-slider-'+e+'" class="slider" style="width:'+n+'px;">'+'<div class="handle"></div>'+"</div>",i='<div class="page-links" name="page-links-'+e+'"></div>';t[0].update("<p>"+r+i+"</p>"),t[1].update("<p>"+i+r+"</p>")}for(var s=0;s<this.page_count;++s)this.pages.push(s+1);this.generatePagesLinks();var o=$$("[name=results-slider-"+e+"]"),u=this,a=0;o.each(function(e){var t=new Control.Slider(e.down(".handle"),e,{range:$R(1,u.pages.length),values:u.pages,sliderValue:u.current_page||1,id:a++,timeout:null,lastSelectedValue:null,onSlide:function(e){u.generatePagesLinks(e);for(var t=0;t<u.sliders;++t)t!=this.id&&(u.locked[t]=!0,typeof u.sliders[t].setValue=="function"&&u.sliders[t].setValue(e),u.locked[t]=!1);this.lastSelectedValue!=e&&(clearTimeout(this.timeout),this.timeout=setTimeout(function(){u.goToPage(e)},400)),this.lastSelectedValue=e},onChange:function(e){u.locked[this.id]||(clearTimeout(this.timeout),u.current_page!=e&&u.goToPage(e))}});t.handleLength=25,u.sliders.push(t)})},declareTableHeader:function(){function o(t,i,o){var u=(new Element(r,{id:"duration"})).update(o),a="DESC";e.indexOf(t)!=-1&&(e.indexOf(a)==-1?u.className="sortcol sortasc":(u.className="sortcol sortdesc",a="ASC")),i=i.replace("${ORDER}",a),u.on("click",function(){s.sort(i)}),n.insert(u)}function u(){t.addSearchToPlayQueueRandom(s.search_value,s.search_comparison,s.search_field,s.order_by,s.first_result,s.result_count)}function a(){t.addSearchToPlayQueueTop(s.search_value,s.search_comparison,s.search_field,s.order_by,s.first_result,s.result_count)}function f(){t.addSearchToPlayQueueBottom(s.search_value,s.search_comparison,s.search_field,s.order_by,s.first_result,s.result_count)}var e=this.order_by.split(",")[0],t=this.jukebox,n=new Element("tr"),r="th",i,s=this;i="artist COLLATE NOCASE ${ORDER}, album COLLATE NOCASE DESC, track DESC, title COLLATE NOCASE DESC",o("artist",i,"Artist"),i="album COLLATE NOCASE ${ORDER}, track DESC, title COLLATE NOCASE DESC",o("album",i,"Album"),i="title COLLATE NOCASE ${ORDER}, artist COLLATE NOCASE DESC, album COLLATE NOCASE DESC, track DESC",o("title",i,"Title"),i="track ${ORDER}, artist COLLATE NOCASE DESC, album COLLATE NOCASE DESC, title COLLATE NOCASE DESC",o("track",i,"Track"),i="genre ${ORDER}, artist COLLATE NOCASE DESC, album COLLATE NOCASE DESC, track DESC, title COLLATE NOCASE DESC",o("genre",i,"Genre"),i="duration ${ORDER}, artist COLLATE NOCASE DESC, album COLLATE NOCASE DESC, track DESC, title COLLATE NOCASE DESC",o("duration",i,"Duration");var l="Add search to play queue [Full]";this.search_comparison=="like"&&(l="Add search to play queue [Current page]");var c=this.createControlsCell(r,u,a,f,l);return c.writeAttribute("id","actions"),n.insert(c),n},createControlsCell:function(e,t,n,r,i){var s=new Element(e),o=(new Element("a")).update('<span class="add-to-play-queue-rand"></span>'),u=(new Element("a")).update('<span class="add-to-play-queue-top"></span>'),a=(new Element("a")).update('<span class="add-to-play-queue-bottom"></span>');return i&&(o.writeAttribute("title",i+" [RANDOM]"),u.writeAttribute("title",i+" [TOP]"),a.writeAttribute("title",i+" [BOTTOM]")),s.insert(u).insert({top:o,bottom:a}),o.on("click",t),u.on("click",n),a.on("click",r),s},initAndDisplaySearchResults:function(){function f(e,t){a.search(1,null,null,e.toString(),"equal",t,"artist,album,track,title",n,!0)}function l(e,t,n){var r=(new Element("a",{href:"javascript:void(0)"})).update(e);return r.on("click",function(){f(t,n)}),r}var t=new Element("tbody"),n=this.result_count,r=$("collection-content-"+this.identifier),s,o=!0,u,a=this.jukebox;if(this.total_results>0){var c=this,h=this.identifier,p=0;this.server_results.each(function(n){function m(){a.addToPlayQueueRandom(n.mid)}function g(){a.addToPlayQueueTop(n.mid)}function y(){a.addToPlayQueueBottom(n.mid)}u=o?"rowodd":"roweven",o=!o;var r=l(n.artist,n.artist,"artist"),f=l(n.album,n.album,"album"),d=[(new Element("td")).insert(r),(new Element("td")).insert(f),(new Element("td")).update(n.title),(new Element("td")).update(n.track),new Element("td"),(new Element("td")).update(i(n.duration))];if(e[n.genre]){var v=l(e[n.genre],n.genre,"genre");d[4].insert(v)}var b=c.createControlsCell("td",m,g,y);d.push(b);var w=(new Element("tr",{id:"library-song-"+h+"-"+p++})).addClassName("library-draggable "+u);for(s=0;s<d.length;++s)w.insert(d[s]);t.insert(w)});var d=(new Date).getTime(),v="results-filelist-"+this.identifier+"-"+d,m=(new Element("table",{id:v})).addClassName("resizable").addClassName("search-table");m.insert(t).insert({top:(new Element("thead")).insert(this.declareTableHeader()),bottom:(new Element("tfoot")).insert(this.declareTableHeader())}),r.update(m),this.tableKit=new TableKit(v,{sortable:!1,editable:!1,trueResize:!0,keepWidth:!0})}else r.update("No results found");if(this.server_results!=null)for(s=0;s<this.server_results.length;s++)new Draggable("library-song-"+this.identifier+"-"+s,{scroll:window,ghosting:!0,revert:function(e){e.style.position="relative"}})},generatePagesLinks:function(e){function p(e,t){var n=(new Element("a",{href:"javascript:void(0)"})).addClassName(t).update(e+" ");return n.on("click",function(){h.goToPage(e)}),n}var t,n,r=[],i=5,o=this.current_page,u=this.page_count;typeof e=="undefined"&&(e=this.current_page);if(u>25)for(t=1,n=Math.ceil(i)+2;t<n;++t)t>0&&t<=u&&r.push(t);else for(t=1;t<=u;++t)r.push(t);var a=[];a[0]=o,r.push(e);for(var f=0;f<a.length;++f){var l=Math.ceil(i/2),c=l;for(t=a[f]-l;t<a[f];++t)t>0&&t<=u&&(l--,r.push(t));r.push(a[f]);for(t=a[f]+1,n=a[f]+Math.ceil(i/2)+1;t<n;++t)t>0&&t<=u&&(c--,r.push(t));if(l>0)for(t=a[f]+Math.ceil(i/2),n=a[f]+Math.ceil(i);t<n;++t)t>0&&t<=u&&r.push(t);else if(c>0)for(t=a[f]-Math.ceil(i),n=a[f]+Math.ceil(i/2);t<n;++t)t>0&&t<=u&&r.push(t)}for(t=u-Math.ceil(i);t<=u;++t)t>0&&t<=u&&r.push(t);r=s(r);var h=this;$$("[name=page-links-"+this.identifier+"]").each(function(n){n.update();var i=null;for(t=0;t<r.length;++t){i!=null&&i!=r[t]-1&&n.insert(" ..... ");var s;r[t]==o?s="slider-link-current-page":r[t]==e?s="slider-link-current-selection":s="slider-link";var u=p(r[t],s);n.insert(u),i=r[t]}})}});var a=Class.create(u,{initialize:function(e,t,n,r){this.name=e,this.uploader=null,this.uploadedFiles=null,this.uploadedFilesEdition=null,this.lastSendingDeletionIdentifier=null,this.lastSendingUpdateIdentifier=null,this.lastSendingValidationIdentifier=null,this.refresher=null,this.tableId=(new Date).getTime(),this.DOM=t,this.rootCSS=n,this.jukebox=r},deleteUploadedSong:function(e){if(this.lastSendingDeletionIdentifier===null){var t=unescape(e);this.lastSendingDeletionIdentifier=t,this.jukebox.deleteUploadedFile(t)}else Notifications.Display(3,"Please retry after the following song has been deleted: "+this.lastSendingDeletionIdentifier)},getUploadedFileEditionFromFilename:function(e){if(this.uploadedFilesEdition===null)return null;for(var t=0,n=this.uploadedFilesEdition.length;t<n;++t)if(this.uploadedFilesEdition[t].filename==e)return this.uploadedFilesEdition[t];return null},updateUploadedSong:function(e){if(this.lastSendingUpdateIdentifier===null){var t=unescape(e);this.lastSendingUpdateIdentifier=t;var n=this.getUploadedFileEditionFromFilename(t),r={file_name:t,title:n.title,album:n.album,artist:n.artist,year:n.year,track:n.track,genre:n.genre};this.jukebox.updateUploadedFile(r)}else Notifications.Display(3,"Please retry after the following song has been updated: "+this.lastSendingUpdateIdentifier)},validateUploadedSong:function(e){if(this.lastSendingValidationIdentifier===null){var t=unescape(e);this.lastSendingValidationIdentifier=t,this.jukebox.validateUploadedFile(t)}else Notifications.Display(3,"Please retry after the following song has been validated: "+this.lastSendingValidationIdentifier)},deletionResponse:function(e,t){var n=this.lastSendingDeletionIdentifier;this.lastSendingDeletionIdentifier=null;if(e=="success"){if(n!==null){for(var r=0,i=this.uploadedFiles.length;r<i;++r)if(this.uploadedFiles[r].filename==n){this.uploadedFiles.splice(r,1),this.uploadedFilesEdition.splice(r,1);break}$("upload-line-"+escape(n)).remove(),Notifications.Display(2,"Song "+n+" sucessfully deleted"),this.reinitTable()}}else e=="error"&&Notifications.Display(4,t)},updateResponse:function(e,t){if(e=="success"){Notifications.Display(1,t);var n=escape(this.lastSendingUpdateIdentifier),r="upload-line-"+n,i=$(r);i.select('[class="modified"]').each(function(e){e.removeClassName("modified")}),i.select('[class="update"]').each(function(e){e.hide()}),i.select('[class="validate"]').each(function(e){e.show()})}else e=="error"&&Notifications.Display(4,t);this.lastSendingUpdateIdentifier=null},validationResponse:function(e,t){var n=this.lastSendingValidationIdentifier;this.lastSendingValidationIdentifier=null;if(e=="success"){Notifications.Display(1,t);if(n!==null){for(var r=0,i=this.uploadedFiles.length;r<i;++r)if(this.uploadedFiles[r].filename==n){this.uploadedFiles.splice(r,1),this.uploadedFilesEdition.splice(r,1);break}$("upload-line-"+escape(n)).remove(),this.reinitTable()}}else e=="error"&&Notifications.Display(4,t)},reinitTable:function(){var e=$("uploaded-files");if(e.down("tbody").childElementCount===0)e.update("No file uploaded yet."),this.uploadedFilesEdition=null,this.uploadedFiles=null;else{var t=(new Date).getTime();$("uploaded-filelist-"+this.tableId).id="uploaded-filelist-"+t,this.tableId=t,this.tableKit=new TableKit("uploaded-filelist-"+this.tableId,{sortable:!0,editable:!0,trueResize:!0,keepWidth:!0})}},treatResponse:function(e){if(e.action_response){var t=e.action_response,n=t["return"],r=t.message;switch(t.name){case"validate_uploaded_file":this.validationResponse(n,r);break;case"delete_uploaded_file":this.deletionResponse(n,r);break;case"update_uploaded_file":this.updateResponse(n,r)}}e.files&&this.displayUploadedFiles(e.files)},getUploadedFileHtml:function(t){var n='<td class="static">'+t.filename+"</td><td>";t.artist&&(n+=t.artist),n+="</td><td>",t.album&&(n+=t.album),n+="</td><td>",t.title&&(n+=t.title),n+="</td><td>"+t.year+"</td><td>";var r=t.track.toString().indexOf("/");r!=-1?n+=t.track.split("/")[0]:n+=t.track,n+="</td><td>",r!=-1?n+=t.track.split("/")[1]:n+=0,n+="</td><td>",e[t.genre]&&(n+=e[t.genre]),n+='</td><td class="static actions"><div><a href="javascript:void(0);">X</a></div><div class="update" style="display:none;"><a href="javascript:void(0);">&nbsp;Update&nbsp;</a></div><div class="validate"><a href="javascript:void(0);">&nbsp;Validate&nbsp;</a></div></td>';var i=escape(t.filename),s=(new Element("tr",{id:"upload-line-"+i})).update(n),o=s.select("div"),u=this;return o[0].on("click",function(){u.deleteUploadedSong(i)}),o[1].on("click",function(){u.updateUploadedSong(i)}),o[2].on("click",function(){u.validateUploadedSong(i)}),s},displayUploadedFiles:function(e){var t,n,r,i,s=$("uploaded-files"),o=s.down("tbody"),u=this;clearTimeout(this.refresher),this.refresher=setTimeout(function(){u.getUploadedFiles()},5e3);if(this.uploadedFiles===null||o===null||o.childElementCount===0&&e.length>0)if(e.length>0){this.uploadedFiles=JSON.parse(JSON.stringify(e)),this.uploadedFilesEdition=JSON.parse(JSON.stringify(e));var a='<table id="uploaded-filelist-'+this.tableId+'" class="sortable resizable editable upload-table">',f='<tr><th>Filename</th><th class="artist">Artist</th><th class="album">Album</th><th class="title">Title</th><th class="year">Year</th><th class="track">Track</th><th class="trackNb">TrackNb</th><th class="genre">Genre</th><th>Actions</th></tr>';a+="<thead>"+f+"</thead><tfoot>"+f+"</tfoot></table>",s.update(a);var l=new Element("tbody");for(t=0;t<e.length;++t)l.insert(this.getUploadedFileHtml(e[t])),this.removeFileFromQQUpload(e[t].filename);s.down("table").insert(l),this.makeCellEditable("artist"),this.makeCellEditable("album"),this.makeCellEditable("title"),this.makeCellEditable("year"),this.makeCellEditable("track"),this.makeCellEditable("trackNb"),this.makeCellEditable("genre"),this.tableKit=new TableKit("uploaded-filelist-"+this.tableId,{sortable:!0,editable:!0,trueResize:!0,keepWidth:!0})}else s.update("No file uploaded yet.");else if(this.uploadedFiles.length>e.length){var c=[];for(n=0,r=this.uploadedFiles.length;n<r;++n){i=!1;for(t=0;t<e.length;++t)if(e[t].filename==this.uploadedFiles[n].filename){i=!0;break}i||c.push(this.uploadedFiles[n].filename)}for(t=0;t<c.length;++t){for(n=0,r=this.uploadedFiles.length;n<r;++n)if(this.uploadedFiles[t].filename==c[t].filename){this.uploadedFiles.splice(t,1),this.uploadedFilesEdition.splice(t,1);break}$("upload-line-"+escape(c[t])).remove()}}else if(this.uploadedFiles.length<e.length){var h=[];for(t=0,r=e.length;t<r;++t){i=!1;for(n=0;n<this.uploadedFiles.length;++n)if(e[t].filename==this.uploadedFiles[n].filename){i=!0;break}i||h.push(e[t])}for(t=0,r=h.length;t<r;++t)this.uploadedFiles.push(JSON.parse(JSON.stringify(h[t]))),this.uploadedFilesEdition.push(JSON.parse(JSON.stringify(h[t]))),$("uploaded-filelist-"+this.tableId).down("tbody").insert(this.getUploadedFileHtml(h[t])),this.removeFileFromQQUpload(h[t].filename);this.uploadedFiles.length!==0&&h.length>0&&this.reinitTable()}},makeCellEditable:function(e){var t=new c(e,this.uploadedFiles,this.uploadedFilesEdition);TableKit.Editable.addCellEditor(t)},removeFileFromQQUpload:function(e){$$(".qq-upload-success").each(function(t){t.down(".qq-upload-file").innerHTML==e&&(t.remove(),Notifications.Display(1,"Informations for "+e+"successfully retrieved."))})},getUploadedFiles:function(){this.jukebox.getUploadedFiles()},clear:function(){clearTimeout(this.refresher),this.refresher=null,this.uploader._handler._queue.length>0&&Notifications.Display(1,"All current uploads canceled."),this.uploader._handler.cancelAll()},updateContent:function(){var e='<div id="file-uploader'+this.identifier+'"></div>'+"<h2>Uploaded files</h2>"+'<div id="uploaded-files" style="overflow:auto;"></div>';this.DOM.down("."+this.rootCSS+"-tabContent-"+this.identifier).update(e),this.uploader=new qq.FileUploader({element:document.getElementById("file-uploader"+this.identifier),action:"upload",params:{id:this.identifier},debug:!0}),this.getUploadedFiles()}});this.DebugTab=Class.create(u,{initialize:function(e,t,n){this.name=e,this.DOM=t,this.rootCSS=n},updateSendingQuery:function(e){this.$debug1.update("<h2>Data sent</h2><p>"+o(e)+"</p>"),this.$debug2.update("<h2>Waiting for response...</h2>")},updateResponse:function(e){e?this.$debug2.update("<h2>Data received:</h2><p> "+e+"</p>"+"<h2>JSON response: </h2>"+"<p>"+o(e.evalJSON())+"</p>"):this.$debug2.update('<img src="images/server_down.jpg" />')},updateContent:function(){var e='<h1>Debug console</h1><table width="100%"><tr><td width="50%"><div></div></td><td width="50%"><div></div></td></tr></table>',t=this.DOM.down("."+this.rootCSS+"-tabContent-"+this.identifier);t.update(e),this.$debug1=t.down("div:first"),this.$debug2=t.down("div:last")}}),this.CustomQueriesTab=Class.create(u,{initialize:function(e,t,n){this.name=e,this.DOM=t,this.rootCSS=n},updateContent:function(){var e='<h1>Custom Json Query</h1><table width="100%"><tr><td colspan="2"><center><textarea style="width:100%;height:160px;"></textarea></center></td></tr><tr><td>Query filler : <select><option value="clear_form">clear_form</option><option value="dummy" selected="selected">--------</option><option value="empty">empty</option><option value="next">next</option><option value="previous">previous</option><option value="add_to_play_queue">add_to_play_queue</option><option value="remove_from_play_queue">remove_from_play_queue</option><option value="move_in_play_queue">move_in_play_queue</option><option value="join_channel">join_channel</option><option value="get_news">get_news</option><option value="search">search</option></select></td><td><input type="button" value="send custom query"/></td></tr></table>',t=this.DOM.down("."+this.rootCSS+"-tabContent-"+this.identifier);t.update(e);var n=t.down("textarea"),r,i,s=t.down("select");s.on("change",function(){var t={},s=this.value;switch(s){case"dummy":return!1;case"clear_form":return n.value="",this.selectedIndex=1,!1;case"add_to_play_queue":case"remove_from_play_queue":case"move_in_play_queue":t={mid:123,play_queue_index:1};break;case"join_channel":t={channel:"trashman"};break;case"get_news":t={first_result:0,result_count:5};break;case"search":t={search_value:"muse",search_field:"artist",order_by:"artist",first_result:0,result_count:10}}return s=="move_in_play_queue"&&(t.new_play_queue_index=0),i=s=="empty"?[]:[new f(s,t)],r=new l(1317675258,i),n.value=JSON.stringify(r.valueOf(),null,"	"),this.selectedIndex=1,!1});var o=t.down("input");o.on("click",function(){if(n.value===""){Notifications.Display(Notifications.LEVELS.warning,"Please fill the textarea");return}var t=JSON.parse(n.value);if(t&&t.action){r=new l(t.timestamp?t.timestamp:0),Object.isArray(t.action)?i=t.action:i=[t.action];for(var s=0;s<i.length;++s){var o=new f(i[s].name,i[s]);r.addAction(o)}p(r)}})}}),this.NotificationTab=Class.create(u,{initialize:function(e,t,n){this.name=e,this.uploader=null,this.DOM=t,this.rootCSS=n},updateContent:function(){function t(t){var n=new Element("input",{type:"button",value:"Test "+t});n.on("click",function(){Notifications.Display(Notifications.LEVELS[t],"Notification: "+t)}),e.insert(n)}var e=this.DOM.down("."+this.rootCSS+"-tabContent-"+this.identifier);e.update("<h1>Notification tests:</h1>");for(var n in Notifications.LEVELS)t(n)}}),f.search=function(e,t,n,i,s,o,u,a,l){var c={identifier:t?t:null,select:!!l,search_value:i,search_comparison:s?s:o!="genre"?"like":"equal",search_field:o,first_result:!e||e==1?0:e,result_count:a};u&&(c.order_by=u),n&&(c.select_fields=n);var h=r({},f.search.defaultOptions,c);return new f("search",h)},f.search.defaultOptions={search_value:"",search_comparison:"like",search_field:"",order_by:"artist,album,track,title",select_fields:"mid,title,album,artist,track,genre,duration",first_result:0,result_count:20},l.prototype.addAction=function(e){if(!(e instanceof f))throw new Error("Invalid action parameter");e.name=="search"?this.search=e:this.actions.push(e)},l.prototype.setTimestamp=function(e){this.lastTimestamp=e},l.prototype.removeAllActions=function(){this.actions=[]},l.prototype.toJSON=function(){return Object.toJSON(this.valueOf())},l.prototype.valueOf=function(){var e;return this.actions.length===0?e={timestamp:this.lastTimestamp}:e={timestamp:this.lastTimestamp,action:this.actions.length==1?this.actions[0]:this.actions},this.search&&(e.search=this.search),e},c.prototype._cancel=function(e){var t=Event.findElement(e,"td");Event.stop(e),this.cancel(t)},c.prototype.cancel=function(e){var t=TableKit.getCellData(e);e.innerHTML=t.htmlContent,t.htmlContent="",t.active=!1},c.prototype._undo=function(e){var t=Event.findElement(e,"td");Event.stop(e),this.undo(t)},c.prototype.undo=function(e){var t=e.up("tr"),n=t.id;for(var r=0,i=this.uploadedFiles.length;r<i;++r){var s=escape(this.uploadedFiles[r].filename);if("upload-line-"+s==n){var o="upload-line-"+s,u=$(o);u.select('[class="modified"]').length==1&&(u.select('[class="update"]').each(function(e){e.hide()}),u.select('[class="validate"]').each(function(e){e.show()})),this.name=="track"?e.update(this.uploadedFiles[r].track.split("/")[0]):this.name=="trackNb"?e.update(this.uploadedFiles[r].track.split("/")[1]):e.update(this.uploadedFiles[r][this.name]),this.uploadedFilesEdition[r][this.name]=this.uploadedFiles[r][this.name];break}}e.removeClassName("modified");var a=TableKit.getCellData(e);a.active=!1},c.prototype._submit=function(e){var t=Event.findElement(e,"td"),n=Event.findElement(e,"form");Event.stop(e),this.submit(t,n)},c.prototype.submit=function(t,n){n=n?n:t.down("form");var r=t.up("tr"),i=r.id,s=n.firstChild,o=s.value;this.name=="genre"&&e[o]?t.update(e[o]):t.update(o);for(var u=0,a=this.uploadedFilesEdition.length;u<a;++u){var f=this.uploadedFilesEdition[u],l=escape(f.filename);if("upload-line-"+l==i){this.name=="genre"?f[this.name]=s.options[s.selectedIndex].value:this.name=="track"?f[this.name].toString().indexOf("/")==-1?f[this.name]=o+"/0":f[this.name]=o+"/"+f[this.name].split("/")[1]:this.name=="trackNb"?f["track"].toString().indexOf("/")==-1?f.track=f.track+"/"+o:f.track=f.track.toString().split("/")[0]+"/"+o:f[this.name]=o;if((this.name=="track"&&this.uploadedFiles[u][this.name].split("/")[0]!=o||this.name=="trackNb"&&this.uploadedFiles[u]["track"].split("/")[1]!=o||this.name!="track"&&this.name!="trackNb"&&o!=this.uploadedFiles[u][this.name])&&!t.hasClassName("modified")){t.addClassName("modified");var c=$("upload-line-"+l);c.select('[class="update"]').each(function(e){e.show()}),c.select('[class="validate"]').each(function(e){e.hide()})}else o==this.uploadedFiles[u][this.name]&&t.hasClassName("modified")&&t.removeClassName("modified");break}}var h=TableKit.getCellData(t);h.active=!1},c.prototype.edit=function(e){e=$(e);if(e.hasClassName("static"))return;var n=e.up("table"),r=e.up("tr"),i=r.id,s,o,u=$(document.createElement("form"));u.id=e.id+"-form",u.addClassName(TableKit.option("formClassName",n.id)[0]),u.onsubmit=this._submit.bindAsEventListener(this);var a=!1;if(this.name=="genre"){var f=document.createElement("select");f.id="genre",u.appendChild(f);for(o=0,s=t.length;o<s;++o){var l=t[o],c=document.createElement("option");c.value=l.id,c.appendChild(document.createTextNode(l.name)),f.appendChild(c)}for(o=0,s=this.uploadedFilesEdition.length;o<s;++o)"upload-line-"+escape(this.uploadedFilesEdition[o].filename)==i&&this.uploadedFilesEdition[o]["genre"]!=this.uploadedFiles[o]["genre"]&&(a=!0)}else{var h=document.createElement("input");h.type="text";for(o=0,s=this.uploadedFilesEdition.length;o<s;++o){var p=this.uploadedFilesEdition[o];if("upload-line-"+escape(p.filename)==i){this.name=="track"?p["track"].toString().indexOf("/")==-1?h.value=p.track:(h.value=p.track.toString().split("/")[0],p["track"].toString().split("/")[1]!=this.uploadedFiles[o]["track"].toString().split("/")[1]&&(a=!0)):this.name=="trackNb"?p["track"].toString().indexOf("/")==-1?h.value="0":(h.value=p.track.toString().split("/")[1],p["track"].toString().split("/")[1]!=this.uploadedFiles[o]["track"].toString().split("/")[1]&&(a=!0)):(h.value=p[this.name],p[this.name]!=this.uploadedFiles[o][this.name]&&(a=!0));break}}u.appendChild(h)}var d=document.createElement("input");d.type="submit",d.value="submit",d.className="editor-ok-button",u.appendChild(d);if(a){var v=document.createElement("a");v.href="#",v.appendChild(document.createTextNode("undo ")),v.onclick=this._undo.bindAsEventListener(this),v.className="editor-undo",u.appendChild(v),u.appendChild(document.createTextNode(" "))}var m=document.createElement("a");m.href="#",m.appendChild(document.createTextNode("cancel")),m.onclick=this._cancel.bindAsEventListener(this),m.className="editor-cancel",u.appendChild(m),e.innerHTML="",e.appendChild(u);for(o=0,s=this.uploadedFilesEdition.length;o<s;++o)if("upload-line-"+escape(this.uploadedFilesEdition[o].filename)==i){var g=$$("select#genre option"),y=g.length;y>0&&y<this.uploadedFilesEdition[o][this.name]&&(g[y-1].selected=!0);for(var b=0;b<y;b++)if(g[b].value==this.uploadedFilesEdition[o][this.name]){g[b].selected=!0;break}}};var h=0,p,v={status:function(){var e=this.id+" is "+(this.streaming?"":"NOT ")+"connected to url "+this.stream+" and currently "+(this.playing?"":"NOT ")+"playing. Current channel is: "+this.channel+". "+this.listenersCount+" user"+(this.listenersCount>1?"s are":" is")+" currently listening. Current song is: "+this.song.title+" - "+this.song.artist+".";return e},remaining:function(){var e=0;if(this.song&&this.lastServerResponse instanceof Date){var t=((new Date).getTime()-this.lastServerResponse.getTime())/1e3;return Math.round(this.song.duration-this.song.elapsed-t)}return e}};r(d.prototype,v),d.defaults={URL:"/api/json",streamURL:"/stream",SM2Folder:"/",autorefresh:!0,autorefresh_delay:3e3,replaceTitle:!0},Object.freeze(d),Object.freeze(d.prototype),this.Jukebox=d,m.defaults={skin:"default",rootClass:"jukebox",skinParams:{dragdrop:!0,playQueueNode:"ul",songNode:"li"}},m.skins={"default":{templates:{player:'<div class="#{root}">	<div class="#{root}-header">		#{canalLabel} <input type="text" class="#{root}-channel" /><input type="button" class="#{root}-channel-button" value="#{canalValue}" />		<span class="#{root}-expand-button">&gt;</span>		<span class="#{root}-collapse-button">&lt;</span>		<span class="#{root}-activity"></span>	</div>	<div class="#{root}-main">		<div class="#{root}-controls">			<span class="#{root}-previous-button"></span><span class="#{root}-next-button"></span>			#{currentSong}			<div class="#{root}-progressbar-wrapper">				<div class="#{root}-progressbar"></div>				<p class="#{root}-song-time"></p>			</div>		</div>		<div class="#{root}-playqueue">			<div class="#{root}-playqueue-content"></div>		</div>	</div>		<div class="#{root}-tabs">		<div class="#{root}-tabs-links">			<a class="#{root}-tab-upload">#{UploadTabName}</a>			<a class="#{root}-tab-query">#{QueryTabName}</a>			<a class="#{root}-tab-notifs">#{NotificationsTabName}</a>			<a class="#{root}-tab-debug">#{DebugTabName}</a>		</div>		<div class="#{root}-tabs-head">			#{searchLabel} <input type="text" class="#{root}-search-input" />			<select class="#{root}-search-genres" style="display:none;"></select>			<select class="#{root}-search-field">				<option value="artist">#{artist}</option>				<option value="title">#{title}</option>				<option value="album">#{album}</option>				<option value="genre">#{genre}</option>			</select> 			<select class="#{root}-results-per-page">				<option value="10">10</option>				<option value="20" selected="selected">20</option>				<option value="30">30</option>				<option value="40">40</option>				<option value="50">50</option>				<option value="60">60</option>				<option value="70">70</option>				<option value="80">80</option>				<option value="90">90</option>				<option value="100">100</option>			</select> 			<input type="button" class="#{root}-search-button" value="#{searchButton}" />		</div>		<div class="#{root}-tabs-header"></div>		<div class="#{root}-tabs-content"></div>	</div>		<div class="#{root}-footer">		<input type="button" class="#{root}-refresh-button" value="#{refreshButton}" />		<input type="checkbox" name="#{root}-autorefresh" class="#{root}-autorefresh" checked="checked" value="autorefresh" /><label for="#{root}-autorefresh"> #{refreshLabel}</label>		<br />		#{pluginLabel} <input type="text" class="#{root}-plugin" value="#{pluginDefault}" style="width: 100px;" />		<input type="button" class="#{root}-plugin-button" value="#{pluginButton}" />	</div>		<div class="#{root}-stream">		<a class="#{root}-stream-play">#{play}</a>		<a class="#{root}-stream-stop">#{stop}</a>	</div>	<span class="#{root}-volume">		<span>#{volume}&nbsp;</span>		<div class="#{root}-volume-slider slider">			<div class="#{root}-volume-handle handle"></div>		</div>		<br clear="all" />	</span></div>',song:'<p class="#{root}-song">	<a class="#{root}-song-artist" href="#">#{artist}</a> - 	<a class="#{root}-song-album" href="#">#{album}</a> - 	<span class="#{root}-song-title">#{song}</span></p>',playQueue:'<li class="#{root}-playqueue-first #{root}-playqueue-droppable">#{playQueueLabel}	<div>		<span class="#{root}-listening-ico"></span>		<span class="#{root}-listening-count">#{listenersCount}</span>	</div>	<a><span class="#{root}-playqueue-shuffle"></span></a>	<a><span class="#{root}-playqueue-delete"></span></a></li>',playQueueSong:'<li class="#{root}-playqueue-#{index} #{root}-playqueue-droppable">	<div class="#{root}-playqueue-song-#{index} #{root}-playqueue-draggable">		<div class="#{root}-playqueue-handle-#{index} #{root}-playqueue-handle">			<a href="javascript:void(0)">#{artist}</a> - 			<a href="javascript:void(0)">#{album}</a> - 			#{title} (#{duration})		</div>		<a><span class="#{root}-playqueue-move-top"></span></a>		<a><span class="#{root}-playqueue-move-bottom"></span></a>		<a><span class="#{root}-playqueue-delete"></span></a>	</div></li>'}},light:{params:{dragdrop:!1,playQueueNode:"tbody",songNode:"tr"},defaultTheme:"white",themes:["white","blue"],templates:{player:'<div class="#{root} #{root}-theme-#{theme}">	<table class="#{root}-main">	<tr>		<td class="#{root}-activity"></td>		<td class="#{root}-controls">			<a href="javascript:;" class="#{root}-previous-button"></a>			<a href="javascript:;" class="#{root}-stream-play" title="#{play}"></a>			<a href="javascript:;" class="#{root}-stream-stop" title="#{stop}"></a>			<a href="javascript:;" class="#{root}-next-button"></a>		</td>		<td class="#{root}-progressbar-container">			<p class="#{root}-song-time"></p>			<div class="#{root}-progressbar-wrapper">				<div class="#{root}-progressbar"></div>			</div>		</td>		<td>			#{currentSong}		</td>		<td class="#{root}-volume">			<div class="#{root}-volume-ico"></div>			<div class="#{root}-volume-slider">				<div class="#{root}-volume-handle"></div>			</div>		</td>		<td class="#{root}-listening">			<div class="#{root}-listening-ico"></div>			<div class="#{root}-listening-count">#{listenersCount}</div>		</td>		<td class="#{root}-expand-collapse">			<a href="javascript:;" class="#{root}-expand-button"></a>			<a href="javascript:;" class="#{root}-collapse-button"></a>		</td>	</tr>	</table>		<div class="#{root}-playqueue">		<div class="#{root}-playqueue-content"></div>	</div></div>',song:'<div class="#{root}-song">	<div class="#{root}-song-title">#{title}</div>	<div>		<a class="#{root}-song-artist" href="javascript:;">#{artist}</a> - 		<a class="#{root}-song-album" href="javascript:;">#{album}</a>	</div></div>',playQueue:"",playQueueSong:'<tr class="#{root}-playqueue-#{index}">	<td>#{index}</td>	<td>		<a href="javascript:;">#{artist}</a> - 		<a href="javascript:;">#{album}</a> - 		#{title}	</td>	<td>#{duration}</td></tr>'}}},Object.freeze(m),Object.freeze(m.prototype)}();